id: PubOffline
name: 'Publish Offline'
description: "This plugin allows administrators to publish a version of their site to another directory on their file system for the express purpose of creating a version of their site offline. It also provides for designers a set of template tags to conditionally display content depending upon whether or not the user is publishing the off or online version of their site."
author_name: Endevver
author_link: http://endevver.com
version: 0.8
schema_version: 3

object_types:
  offline_batch: 'PubOffline::OfflineBatch'
  ts_job:
    offline_batch_id: integer

callbacks:
    build_file_filter: $PubOffline::PubOffline::Plugin::build_file_filter
    build_page: $PubOffline::PubOffline::Plugin::build_page

tasks: $PubOffline::PubOffline::Plugin::load_tasks

task_workers:
    publish_offline:
        label: "Publishes an offline version of content"
        class: 'PubOffline::Worker::PublishOffline'
    copy_static_offline:
        label: "Copies static files into an offline folder"
        class: 'MT::Worker::CopyStaticOffline'

options:
    enable_puboffline:
        label: 'Enable Publish Offline'
        hint: 'Enable or disable Publish Offline for this blog.'
        scope: blog
        type: checkbox
        order: 1
    output_file_path:
        label: 'Output File Path'
        hint: 'This is the path that Publish Offline will output its files to. This should be an absolute file path; MT tags are allowed, though <a href="http://www.movabletype.org/documentation/appendices/tags/blogsitepath.html" target="_blank">BlogSitePath</a> is likley the only tag you would use.'
        scope: blog
        type: text
        default: '<mt:BlogSitePath>puboffline/'
        order: 2
    output_url:
        label: 'Output URL'
        hint: 'Enter a URL to the offline version of this web site. If the Output File Path does not reference a web accessible directory, leave this field blank. (The Output URL is supplied with the notification email only.)'
        scope: blog
        type: text
        default: '<mt:BlogURL>puboffline/'
        order: 3

# Obsolete
settings:
  zip:
    scope: blog
    default: 0
  date:
    scope: blog
    default: 0

tags:
  block:
    IsOfflineMode?: $PubOffline::PubOffline::Plugin::tag_is_offline

applications:
  cms:
    methods:
      pub_offline: $PubOffline::PubOffline::Plugin::send_to_queue

page_actions:
  list_templates:
    pub_offline:
      label: 'Publish Offline Version'
      order: 1012
      dialog: pub_offline
      permission: publish_post
      condition: >
        sub { MT->app->blog; }

